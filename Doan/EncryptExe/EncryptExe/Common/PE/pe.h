#include <windows.h>
#include <string>
#include <stdio.h>
#include <Shlwapi.h>
#include <imagehlp.h>

#pragma comment(lib, "Shlwapi.lib")
#pragma comment(lib, "Imagehlp.lib")

#define MAX_SECTIONS 12

#define ParamRelate(paramName)

#define DivUp(a,b) ((a+b-1)/(b))

#define Align(a,b) (DivUp(a,b)*(b))
#define DAlign(a,b) (((a)/(b))*(b))

#define cmin(a,b) (a)<(b)?(a):(b)

#pragma pack(1)
struct SectionData {
	char hashdata[33];
	DWORD buf_size;
	char buf[1];
};
#pragma pack()

HMODULE Load(LPVOID Param);

//get hash from common/inline/namehash.h
FARPROC GetFuncAddress(HMODULE hMod, unsigned int hashProc);

FARPROC GetFuncAddress(HMODULE hMod, const char * szProc);

bool HookExport(HMODULE hMod, FARPROC fpOrgFunc, FARPROC fpChangeTo);

void Release(HMODULE hMod);

char *InsertLastSection(const void *pImg, DWORD &sztImg, SectionData *sData, char *sectionname);

char *MoveSection(const void *pImg, DWORD sztImg, int old_index, int new_index);

char *ExpandSection(const void *pImg, DWORD &sztImg, void *Data, DWORD dwData, int index);


