#include "vmware_files.h"

/*
Check against VMWare blacklisted files
*/
VOID vmware_files()
{
	/* Array of strings of blacklisted paths */
	char* szPaths[] = {
		"system32\\drivers\\vmmouse.sys",
		"system32\\drivers\\vmhgfs.sys",
		"system32\\drivers\\vm3dmp.sys",
		"system32\\drivers\\vmci.sys",
		"system32\\drivers\\vmhgfs.sys",
		"system32\\drivers\\vmmemctl.sys",
		"system32\\drivers\\vmmouse.sys",
		"system32\\drivers\\vmrawdsk.sys",
		"system32\\drivers\\vmusbmouse.sys"
	};

	/* Getting Windows Directory */
	WORD dwlength = sizeof(szPaths) / sizeof(szPaths[0]);
	TCHAR szWinDir[MAX_PATH] = "";
	TCHAR szPath[MAX_PATH] = "";
	GetWindowsDirectory(szWinDir, MAX_PATH);

	/* Check one by one */
	for (int i = 0; i < dwlength; i++)
	{
		PathCombine(szPath, szWinDir, szPaths[i]);
		if (is_FileExists(szPath))
			exit(1);
	}
}
