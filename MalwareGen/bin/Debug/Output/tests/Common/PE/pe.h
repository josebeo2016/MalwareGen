#pragma once
#include <windows.h>
#include <stdio.h>
#include <Shlwapi.h>
#include <imagehlp.h>

#pragma comment(lib, "Shlwapi.lib")
#pragma comment(lib, "Imagehlp.lib")

#define ParamRelate(paramName)
#define DivUp(a,b) ((a+b-1)/(b))
#define Align(a,b) (DivUp(a,b)*(b))
#define DAlign(a,b) (((a)/(b))*(b))

#define cmin(a,b) (a)<(b)?(a):(b)

struct PE {
	FARPROC fnVirtualAlloc;
	FARPROC fnVirtualFree;
	FARPROC fnLoadLibraryA;
	FARPROC fnGetProcAddress;
	FARPROC fnmemcpy;
	DWORD size;
	char buf[1];
};

#pragma pack(1)
struct SectionData {
	char hashdata[33];
	DWORD buf_size;
	char buf[1];
};
#pragma pack()

HMODULE Load(LPVOID Param);
void End_Load();

//get hash from common/inline/namehash.h
FARPROC GetFuncAddress(HMODULE hMod, unsigned int hashProc);

FARPROC GetFuncAddress(HMODULE hMod, const char * szProc);

bool HookExport(HMODULE hMod, FARPROC fpOrgFunc, FARPROC fpChangeTo);

void Release(HMODULE hMod);

char *InsertLastSection(const void *pImg, DWORD &sztImg, SectionData *sData);
