<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>

    <%- include layout/head %>
</head>
<body>
<%- include layout/nav %>

<div class="panel panel-default">
    <div class="panel-heading">
        Victims
    </div>
    <!-- /.panel-heading -->
    <div class="panel-body">
        <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>IP</th>
                    <th>Username</th>
                    <th>ComputerName</th>
                    <th>PID</th>
                    <th>requested_at</th>
                </tr>
                </thead>
                <tbody id="victim">
                <% if(data && data.victims){ %>
                <% for(var i = 0; i < data.victims.length; i++){ %>
                <tr>
                    <td><%= data.victims[i].id %></td>
                    <td><%= data.victims[i].IP %></td>
                    <td><%= data.victims[i].Username %></td>
                    <td><%= data.victims[i].ComputerName %></td>
                    <td><%= data.victims[i].PID %></td>
                    <td><%= data.victims[i].requested_at %></td>
                    <td>
                        <a href="/admin/interface/<%= data.victims[i].id %>" class="btn btn-primary"> Interface </a>
                        <a href="/admin/remove/<%= data.victims[i].id %>" class="btn btn-danger"> Remove </a>
                    </td>
                </tr>
                <% } %>
                <% } %>
                </tbody>
            </table>
        </div>
        <!-- /.table-responsive -->
    </div>
    <!-- /.panel-body -->
</div>
<script type="text/javascript">
    setInterval(function () {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var data = this.responseText;
                var json_data = JSON.parse(data);
                var table = document.getElementById('victim');
                console.log(json_data)
                table.innerHTML = ''
                json_data.victims.forEach(function(item, index){
                    console.log('item',item)
                    var row = table.insertRow(index)
                    var id = row.insertCell(0)
                    id.innerHTML = item.id
                    var ip = row.insertCell(1)
                    ip.innerHTML = item.IP
                    var Username = row.insertCell(2)
                    Username.innerHTML = item.Username
                    var ComputerName = row.insertCell(3)
                    ComputerName.innerHTML = item.ComputerName
                    var PID = row.insertCell(4)
                    PID.innerHTML = item.PID
                    var requested_at = row.insertCell(5)
                    requested_at.innerHTML = item.requested_at
                    var button = row.insertCell(6)
                    button.innerHTML = "<a href=\"/admin/interface/" + item.id + "\" class=\"btn btn-primary\"> Interface </a><a href=\"/admin/remove/" + item.id + "\" class=\"btn btn-danger\"> Remove </a>"
                })
            }
        };
        xhttp.open("GET", "/admin/update", true);
        xhttp.send();
    }, 2000);
</script>
</body>
</html>